tools:
  add-agent-server:
    name: add-agent-server
    info: |
      Creates and starts a multi-agent FastAPI server that hosts all your agents in one service.
      This command both creates the server code AND automatically starts it running.
      The server runs with hot reload and includes WebSocket monitoring, test utilities, and API endpoints.
      Creates the server in "agent-server" directory by default.
    await: [scaffold-agent-server]
    run:
      - id: scaffold-agent-server
        tool: polytope/scaffold
        args:
          actions:
            - template: {type: repo, repo: "#pt-clj pt/module-repo-ref", path: agent-server}
              path: agent-server
              add-to-tools: [{tool: default, call: agent-server}]
            - template: https://github.com/opper-ai/opperai-agent-sdk.git
              path: lib/py/opper-agent-sdk
              print-files: []
              on-exists: skip
      - id: agent-server
        after: {step: scaffold-agent-server}
        code: '#pt-clj (pt/call-module "agent-server" {}))'
      - id: scaffold-agent-dashboard
        tool: polytope/scaffold
        args:
          actions:
            - template: {type: repo, repo: "#pt-clj pt/module-repo-ref", path: agent-management-ui}
              path: agent-dashboard
              on-conflict: skip
              add-to-tools: [{tool: default, call: agent-dashboard}]
      - id: agent-dashboard
        after: {step: scaffold-agent-dashboard}
        code: '#pt-clj (pt/call-module "agent-dashboard" {})'
