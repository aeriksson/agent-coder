tools:
  create-agent-api:
    info: |
      Creates a complete Python agent API with FastAPI server already running.
      Always use this when creating a new agent project - DO NOT create additional APIs.
      This automatically starts a dev container with the API service running on a port.
      The project uses uv+FastAPI with Opper Agent SDK integration.
      Includes agent management endpoints, WebSocket monitoring, and testing tools.
      The environment is set to dev with hot reload enabled.
    await: [scaffold-agent-service]
    params:
      - id: path
        info: Path relative to the project root where the service should be created.
        type: [default, str, api]
    run:
      - id: scaffold-agent-service
        tool: polytope/scaffold
        args:
          actions:
            - template: {type: repo, repo: "#pt-clj pt/module-repo-ref", path: python-agent-api}
              path: pt.param path
              add-to-tools: [{tool: default, call: api}]
            - template: https://github.com/opper-ai/opperai-agent-sdk.git
              path: lib/py/opper-agent-sdk
              print-files: []
              on-exists: skip
      - id: api
        after: {step: scaffold-agent-service}
        code: |-
          #pt-clj
          (-> (clojure.string/replace (:path params) #"[^A-Za-z0-9-]*$" "")
              (clojure.string/replace  #".*/" "")
              (pt/call-module {}))
      - id: scaffold-agent-dashboard
        tool: polytope/scaffold
        args:
          actions:
            - template: {type: repo, repo: "#pt-clj pt/module-repo-ref", path: agent-management-ui}
              path: agent-dashboard
              on-conflict: skip
              add-to-tools: [{tool: default, call: agent-dashboard}]
      - id: agent-dashboard
        after: {step: scaffold-agent-dashboard}
        code: '#pt-clj (pt/call-module "agent-dashboard" {})'
  create-agent-dashboard:
    info: |
      Creates an agent management dashboard UI for monitoring and testing Opper agents.
      This React dashboard connects to agent APIs to provide real-time monitoring,
      agent testing, and execution event streaming via WebSocket.
      The project uses bun+shadcn+react-router v7 with agent-specific components.
    await: [scaffold-agent-dashboard]
    run:
      - id: scaffold-agent-dashboard
        tool: polytope/scaffold
        args:
          actions:
            - template: {type: repo, repo: "#pt-clj pt/module-repo-ref", path: agent-management-ui}
              path: agent-dashboard
              on-conflict: skip
              add-to-tools: [{tool: default, call: agent-dashboard}]
      - id: agent-dashboard
        after: {step: scaffold-agent-dashboard}
        code: '#pt-clj (pt/call-module "agent-dashboard" {})'
